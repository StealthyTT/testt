blueprint:
  name: Binary Sensor with Light Control and Toggle Logic
  description: |
    Turns on the light when the binary sensor detects a state change, disables the automation if the light is toggled off and on within a short time,
    and re-enables it if the light has been off for 5 minutes.
  domain: automation
  input:
    binary_sensor:
      name: Binary Sensor
      description: The binary sensor to detect changes in state.
      selector:
        entity:
          domain: binary_sensor
    light_entity:
      name: Light
      description: The light to control.
      selector:
        entity:
          domain: light
    toggle_count_helper:
      name: Toggle Count Helper
      description: The helper to count how many times the light has been toggled.
      selector:
        entity:
          domain: input_number
    automation_enabled_helper:
      name: Automation Enabled Helper
      description: The helper to enable or disable the automation.
      selector:
        entity:
          domain: input_boolean
    reset_timer:
      name: Reset Timer
      description: Timer to reset toggle count after inactivity.
      selector:
        entity:
          domain: timer
    light_off_timer:
      name: Light Off Timer
      description: Timer to track if the light has been off for 5 minutes.
      selector:
        entity:
          domain: timer

trigger:
  - platform: state
    entity_id: !input 'binary_sensor'
    to: "on"

condition:
  - condition: state
    entity_id: !input 'automation_enabled_helper'
    state: "on"  # Only proceed if automation is enabled

action:
  - service: light.turn_on
    target:
      entity_id: !input 'light_entity'
  
  - service: timer.start
    target:
      entity_id: !input 'reset_timer'  # Start the main reset timer

  - service: input_numbe
