blueprint:
  name: "Multiple Motion Sensors Control Lights (Max 5)"
  description: "Turn on and off multiple lights based on different motion sensors, with optional delays."
  domain: automation
  input:
    motion_sensors:
      name: "Motion Sensors and Lights"
      description: "Map motion sensors to their corresponding lights (max 5)."
      selector:
        object:
          motion_sensor_1:
            name: "Motion Sensor 1"
            description: "First motion sensor."
            selector:
              entity:
                domain: binary_sensor
          light_1:
            name: "Light 1"
            description: "First light to control."
            selector:
              entity:
                domain: light
          motion_sensor_2:
            name: "Motion Sensor 2"
            description: "Second motion sensor."
            selector:
              entity:
                domain: binary_sensor
          light_2:
            name: "Light 2"
            description: "Second light to control."
            selector:
              entity:
                domain: light
          motion_sensor_3:
            name: "Motion Sensor 3"
            description: "Third motion sensor."
            selector:
              entity:
                domain: binary_sensor
          light_3:
            name: "Light 3"
            description: "Third light to control."
            selector:
              entity:
                domain: light
          motion_sensor_4:
            name: "Motion Sensor 4"
            description: "Fourth motion sensor."
            selector:
              entity:
                domain: binary_sensor
          light_4:
            name: "Light 4"
            description: "Fourth light to control."
            selector:
              entity:
                domain: light
          motion_sensor_5:
            name: "Motion Sensor 5"
            description: "Fifth motion sensor."
            selector:
              entity:
                domain: binary_sensor
          light_5:
            name: "Light 5"
            description: "Fifth light to control."
            selector:
              entity:
                domain: light
    delay_off:
      name: "Delay Off (seconds)"
      description: "How long to keep the light on after motion is no longer detected."
      default: 10
      selector:
        number:
          min: 1
          max: 600
          unit_of_measurement: "seconds"
          step: 1

trigger:
  - platform: state
    entity_id: !input motion_sensors.motion_sensor_1
    to: 'on'
  - platform: state
    entity_id: !input motion_sensors.motion_sensor_2
    to: 'on'
  - platform: state
    entity_id: !input motion_sensors.motion_sensor_3
    to: 'on'
  - platform: state
    entity_id: !input motion_sensors.motion_sensor_4
    to: 'on'
  - platform: state
    entity_id: !input motion_sensors.motion_sensor_5
    to: 'on'

action:
  - choose:
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_1
            state: 'on'
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input motion_sensors.light_1
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_2
            state: 'on'
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input motion_sensors.light_2
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_3
            state: 'on'
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input motion_sensors.light_3
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_4
            state: 'on'
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input motion_sensors.light_4
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_5
            state: 'on'
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input motion_sensors.light_5

  - wait_for_trigger:
      - platform: state
        entity_id: !input motion_sensors.motion_sensor_1
        to: 'off'
      - platform: state
        entity_id: !input motion_sensors.motion_sensor_2
        to: 'off'
      - platform: state
        entity_id: !input motion_sensors.motion_sensor_3
        to: 'off'
      - platform: state
        entity_id: !input motion_sensors.motion_sensor_4
        to: 'off'
      - platform: state
        entity_id: !input motion_sensors.motion_sensor_5
        to: 'off'
    timeout: '00:{{ input.delay_off }}:00'

  - delay: '00:{{ input.delay_off }}:00'

  - choose:
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_1
            state: 'off'
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input motion_sensors.light_1
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_2
            state: 'off'
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input motion_sensors.light_2
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_3
            state: 'off'
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input motion_sensors.light_3
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_4
            state: 'off'
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input motion_sensors.light_4
      - conditions:
          - condition: state
            entity_id: !input motion_sensors.motion_sensor_5
            state: 'off'
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input motion
